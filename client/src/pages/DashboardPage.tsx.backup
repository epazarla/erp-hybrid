// Bu dosya baÄŸÄ±msÄ±z bir TypeScript React bileÅŸeni olarak dÃ¼zenlenmiÅŸtir
// GerÃ§ek proje iÃ§inde kullanmak iÃ§in, bu dosyayÄ± proje klasÃ¶rÃ¼ne taÅŸÄ±yÄ±n
// ve import ifadelerini etkinleÅŸtirin

// import React, { useState, useEffect } from 'react';
// import { 
//   Box, 
//   Grid, 
//   Typography, 
//   Card, 
//   CardContent, 
//   Avatar, 
//   List, 
//   ListItem, 
//   ListItemAvatar, 
//   ListItemText, 
//   Chip,
//   IconButton,
//   Button,
//   LinearProgress,
//   useTheme
// } from '@mui/material';
// import { 
//   TrendingUp as TrendingUpIcon,
//   TrendingDown as TrendingDownIcon,
//   MoreVert as MoreVertIcon,
//   CheckCircle as CheckCircleIcon,
//   Schedule as ScheduleIcon,
//   Flag as FlagIcon,
//   Facebook as FacebookIcon,
//   Instagram as InstagramIcon,
//   Twitter as TwitterIcon,
//   YouTube as YouTubeIcon,
//   ArrowForward as ArrowForwardIcon,
//   Business as BusinessIcon,
//   Done as DoneIcon
// } from '@mui/icons-material';
// import { 
//   Chart as ChartJS, 
//   CategoryScale, 
//   LinearScale, 
//   PointElement, 
//   LineElement, 
//   BarElement,
//   Title, 
//   Tooltip, 
//   Legend, 
//   ArcElement,
//   Filler
// } from 'chart.js';
// import { Line, Bar, Doughnut } from 'react-chartjs-2';
// import { format } from 'date-fns';
// import { tr } from 'date-fns/locale';
// import { Task, getAllTasks, TASKS_UPDATED_EVENT, TASK_STATUSES } from '../services/TaskService';
// import { getAllUsers } from '../services/UserService';
// import { User } from '../types/User';
// import { Client, getAllClients, CLIENTS_UPDATED_EVENT, SECTORS } from '../services/ClientService';

// Tip tanÄ±mlamalarÄ±
type User = {
  id: number;
  name: string;
  email: string;
  status: string;
  avatarUrl: string;
};

type Task = {
  id: number;
  title: string;
  description: string;
  status: string;
  priority: string;
  assigned_to: number;
  created_at: string;
  due_date: string;
  category?: string;
};

type ClientType = {
  id: string;
  name: string;
  sector: string;
  isActive: boolean;
  monthlyIncome?: number;
  paymentStatus?: 'paid' | 'pending' | 'overdue' | 'none';
  lastPaymentDate?: string;
};

// Sabit deÄŸerler
const TASKS_UPDATED_EVENT = 'tasksUpdated';
const CLIENTS_UPDATED_EVENT = 'clientsUpdated';
const TASK_STATUSES = ['Bekliyor', 'Devam Ediyor', 'TamamlandÄ±', 'Ä°ptal Edildi'];
const SECTORS = [
  'Teknoloji',
  'E-ticaret',
  'Ãœretim',
  'Hizmet',
  'SaÄŸlÄ±k',
  'EÄŸitim',
  'GÄ±da',
  'Ä°nÅŸaat',
  'Tekstil',
  'Otomotiv',
  'Finans',
  'DiÄŸer'
];

// Mock veri fonksiyonlarÄ±
const getAllTasks = (): Task[] => {
  return [];
};

const getAllUsers = (): User[] => {
  return [];
};

const getAllClients = (onlyActive?: boolean): ClientType[] => {
  return [];
};

// Format fonksiyonu
const format = (date: Date, formatStr: string, options?: any): string => {
  return date.toLocaleDateString('tr-TR');
};

// Locale
const tr = {};

// React ve Material UI bileÅŸenleri iÃ§in mock tanÄ±mlamalar
const React = { createElement: (...args: any[]) => ({}) };
const useState = <T,>(initialState: T): [T, (newState: T) => void] => [initialState, () => {}];
const useEffect = (effect: () => void | (() => void), deps?: any[]) => {};
const useTheme = () => ({ 
  palette: { 
    mode: 'light',
    primary: { main: '#1976d2' }, 
    secondary: { main: '#dc004e' }, 
    error: { main: '#f44336' }, 
    warning: { main: '#ff9800' }, 
    info: { main: '#2196f3' }, 
    success: { main: '#4caf50' } 
  } 
});

// Material UI bileÅŸenleri iÃ§in mock tanÄ±mlamalar
const Box = (props: any) => React.createElement('div', props);
const Grid = (props: any) => React.createElement('div', props);
const Typography = (props: any) => React.createElement('p', props);
const Card = (props: any) => React.createElement('div', props);
const CardContent = (props: any) => React.createElement('div', props);
const Avatar = (props: any) => React.createElement('div', props);
const List = (props: any) => React.createElement('ul', props);
const ListItem = (props: any) => React.createElement('li', props);
const ListItemAvatar = (props: any) => React.createElement('div', props);
const ListItemText = (props: any) => React.createElement('div', props);
const Chip = (props: any) => React.createElement('div', props);
const IconButton = (props: any) => React.createElement('button', props);
const Button = (props: any) => React.createElement('button', props);
const LinearProgress = (props: any) => React.createElement('div', props);

// Material UI Icons iÃ§in mock tanÄ±mlamalar
const TrendingUpIcon = () => React.createElement('span', {}, 'â†‘');
const TrendingDownIcon = () => React.createElement('span', {}, 'â†“');
const MoreVertIcon = () => React.createElement('span', {}, 'â‹®');
const CheckCircleIcon = () => React.createElement('span', {}, 'âœ“');
const ScheduleIcon = () => React.createElement('span', {}, 'â±');
const FlagIcon = () => React.createElement('span', {}, 'âš‘');
const FacebookIcon = () => React.createElement('span', {}, 'f');
const InstagramIcon = () => React.createElement('span', {}, 'i');
const TwitterIcon = () => React.createElement('span', {}, 't');
const YouTubeIcon = () => React.createElement('span', {}, 'y');
const ArrowForwardIcon = () => React.createElement('span', {}, 'â†’');
const BusinessIcon = () => React.createElement('span', {}, 'ðŸ¢');
const DoneIcon = () => React.createElement('span', {}, 'âœ“');

// Chart.js iÃ§in mock tanÄ±mlamalar
const ChartJS = { register: (...args: any[]) => {} };
const CategoryScale = {};
const LinearScale = {};
const PointElement = {};
const LineElement = {};
const BarElement = {};
const Title = {};
const Tooltip = {};
const Legend = {};
const ArcElement = {};
const Filler = {};

// Chart bileÅŸenleri iÃ§in mock tanÄ±mlamalar
const Line = (props: any) => React.createElement('canvas', props);
const Bar = (props: any) => React.createElement('canvas', props);
const Doughnut = (props: any) => React.createElement('canvas', props);

// Aktif kullanÄ±cÄ±larÄ± getiren fonksiyon
const getActiveUsers = (): User[] => {
  const allUsers = getAllUsers();
  return allUsers.filter(user => user.status === 'active');
};

// Chart.js bileÅŸenlerini kaydet
ChartJS.register(
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  BarElement,
  Title,
  Tooltip,
  Legend,
  ArcElement,
  Filler
);

// KullanÄ±cÄ± avatar URL'lerini Ã¶nbellek iÃ§in saklayacak nesne
const userAvatars: Record<number, string> = {
  1: 'https://randomuser.me/api/portraits/men/1.jpg',
  2: 'https://randomuser.me/api/portraits/women/2.jpg',
  3: 'https://randomuser.me/api/portraits/men/3.jpg',
  4: 'https://randomuser.me/api/portraits/women/4.jpg',
  5: 'https://randomuser.me/api/portraits/men/5.jpg'
};

// Proje arayÃ¼zÃ¼
interface Project {
  name: string;
  progress: number;
  client: string;
  totalTasks: number;
  completedTasks: number;
}

// MÃ¼ÅŸteri avatar renklerini belirlemek iÃ§in kullanÄ±lacak renkler
const avatarColors = [
  '#1877f2', // Mavi
  '#e1306c', // Pembe
  '#ff9800', // Turuncu
  '#4caf50', // YeÅŸil
  '#9c27b0', // Mor
  '#f44336', // KÄ±rmÄ±zÄ±
  '#2196f3', // AÃ§Ä±k Mavi
  '#607d8b', // Gri Mavi
  '#795548', // Kahverengi
  '#00bcd4', // Turkuaz
];

export default function DashboardPage() {
  const theme = useTheme();
  
  // State tanÄ±mlamalarÄ±
  const [tasks, setTasks] = useState<Task[]>([]);
  const [activeUsers, setActiveUsers] = useState<User[]>([]);
  const [activeClients, setActiveClients] = useState<ClientType[]>([]);
  const [ongoingTasks, setOngoingTasks] = useState<Task[]>([]);
  const [completedTasks, setCompletedTasks] = useState<Task[]>([]);
  const [completedTaskCount, setCompletedTaskCount] = useState<number>(0);
  const [completedTasksChange, setCompletedTasksChange] = useState<number>(0);
  const [projects, setProjects] = useState<Project[]>([]);
  const [activeProjectCount, setActiveProjectCount] = useState<number>(0);
  
  // GÃ¶revleri, kullanÄ±cÄ±larÄ± ve mÃ¼ÅŸterileri yÃ¼kle
  useEffect(() => {
    loadTasks();
    loadUsers();
    loadClients();
    
    // GÃ¶rev gÃ¼ncellemelerini dinle
    const handleTasksUpdated = () => {
      console.log('GÃ¶revler gÃ¼ncellendi, dashboard yeniden yÃ¼kleniyor...');
      loadTasks();
    };
    
    // MÃ¼ÅŸteri gÃ¼ncellemelerini dinle
    const handleClientsUpdated = () => {
      console.log('MÃ¼ÅŸteriler gÃ¼ncellendi, dashboard yeniden yÃ¼kleniyor...');
      loadClients();
    };
    
    window.addEventListener(TASKS_UPDATED_EVENT, handleTasksUpdated);
    window.addEventListener(CLIENTS_UPDATED_EVENT, handleClientsUpdated);
    
    return () => {
      window.removeEventListener(TASKS_UPDATED_EVENT, handleTasksUpdated);
      window.removeEventListener(CLIENTS_UPDATED_EVENT, handleClientsUpdated);
    };
  }, []);
  
  // GÃ¶revleri yÃ¼kle ve projeleri oluÅŸtur
  const loadTasks = () => {
    try {
      const allTasks = getAllTasks();
      setTasks(allTasks);
      
      // Devam eden gÃ¶revleri filtrele (en fazla 3 tane)
      const ongoing = allTasks
        .filter(task => task.status === 'Devam Ediyor')
        .sort((a, b) => new Date(a.due_date).getTime() - new Date(b.due_date).getTime())
        .slice(0, 3);
      
      setOngoingTasks(ongoing);
      
      // Tamamlanan gÃ¶revleri filtrele (en fazla 3 tane, en son tamamlananlar)
      const completed = allTasks
        .filter(task => task.status === 'TamamlandÄ±')
        .sort((a, b) => new Date(b.due_date).getTime() - new Date(a.due_date).getTime()) // En son tamamlananlar Ã¶nce
        .slice(0, 3);
      
      setCompletedTasks(completed);
      
      // GÃ¶rev istatistiklerini hesapla
      const totalCompletedTasks = allTasks.filter(task => task.status === 'TamamlandÄ±').length;
      setCompletedTaskCount(totalCompletedTasks);
      
      const lastMonthDate = new Date();
      lastMonthDate.setMonth(lastMonthDate.getMonth() - 1);
      
      const lastMonthCompletedTasks = allTasks.filter(task => 
        task.status === 'TamamlandÄ±' && 
        new Date(task.due_date) < new Date() && 
        new Date(task.due_date) > lastMonthDate
      ).length;
      
      // Tamamlanan gÃ¶rev artÄ±ÅŸ yÃ¼zdesini hesapla
      const previousMonthDate = new Date(lastMonthDate);
      previousMonthDate.setMonth(previousMonthDate.getMonth() - 1);
      
      const previousMonthCompletedTasks = allTasks.filter(task => 
        task.status === 'TamamlandÄ±' && 
        new Date(task.due_date) < lastMonthDate && 
        new Date(task.due_date) > previousMonthDate
      ).length;
      
      // YÃ¼zde deÄŸiÅŸimi hesapla (eÄŸer Ã¶nceki ay 0 ise, %100 artÄ±ÅŸ say)
      let completedTasksChangePercent = 0;
      if (previousMonthCompletedTasks === 0) {
        completedTasksChangePercent = lastMonthCompletedTasks > 0 ? 100 : 0;
      } else {
        completedTasksChangePercent = Math.round(
          ((lastMonthCompletedTasks - previousMonthCompletedTasks) / previousMonthCompletedTasks) * 100
        );
      }
      
      setCompletedTasksChange(completedTasksChangePercent);
      
      // GÃ¶revlerden proje durumlarÄ±nÄ± oluÅŸtur
      const projectsData = generateProjectsFromTasks(allTasks);
      setProjects(projectsData);
      setActiveProjectCount(projectsData.length);
      
    } catch (error) {
      console.error('GÃ¶revler yÃ¼klenirken hata oluÅŸtu:', error);
    }
  };
  
  // GÃ¶revlerden proje durumlarÄ±nÄ± oluÅŸtur
  const generateProjectsFromTasks = (allTasks: Task[]): Project[] => {
    // Ã–nce mÃ¼ÅŸteri bazÄ±nda gÃ¶revleri grupla
    const tasksByClient: { [key: string]: { tasks: Task[], clientName: string } } = {};
    
    // Her gÃ¶rev iÃ§in kategori bilgisini kontrol et
    allTasks.forEach(task => {
      if (task.category) {
        // Kategori adÄ±nÄ± mÃ¼ÅŸteri ID'si olarak kullan (basitleÅŸtirme)
        // GerÃ§ek uygulamada, gÃ¶revlerin mÃ¼ÅŸteri ID'leri olmalÄ±dÄ±r
        const clientId = task.category;
        
        if (!tasksByClient[clientId]) {
          // MÃ¼ÅŸteri adÄ±nÄ± bulmak iÃ§in aktif mÃ¼ÅŸterileri kontrol et
          const client = activeClients.find(c => c.name === clientId || c.id === clientId);
          
          tasksByClient[clientId] = {
            tasks: [],
            clientName: client ? client.name : clientId // EÄŸer mÃ¼ÅŸteri bulunursa adÄ±nÄ± kullan, yoksa kategori adÄ±nÄ±
          };
        }
        
        tasksByClient[clientId].tasks.push(task);
      }
    });
    
    // MÃ¼ÅŸteri gruplarÄ±nÄ± proje verilerine dÃ¶nÃ¼ÅŸtÃ¼r
    const projectsData: Project[] = [];
    
    Object.keys(tasksByClient).forEach(clientId => {
      const clientData = tasksByClient[clientId];
      const clientTasks = clientData.tasks;
      const totalTasks = clientTasks.length;
      const completedTasks = clientTasks.filter(t => t.status === 'TamamlandÄ±').length;
      const progress = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
      
      projectsData.push({
        name: clientData.clientName,
        progress,
        client: clientData.clientName,
        totalTasks,
        completedTasks
      });
    });
    
    // Ä°lerleme durumuna gÃ¶re sÄ±rala (en yÃ¼ksek ilerleme en Ã¼stte)
    return projectsData.sort((a, b) => b.progress - a.progress);
  };
  
  // KullanÄ±cÄ±larÄ± yÃ¼kle
  const loadUsers = (): void => {
    try {
      const users = getActiveUsers();
      setActiveUsers(users);
    } catch (error) {
      console.error('KullanÄ±cÄ±lar yÃ¼klenirken hata oluÅŸtu:', error);
    }
  };
  
  // MÃ¼ÅŸterileri yÃ¼kle
  const loadClients = () => {
    try {
      const clients = getAllClients(true); // Sadece aktif mÃ¼ÅŸterileri al
      setActiveClients(clients);
    } catch (error) {
      console.error('MÃ¼ÅŸteriler yÃ¼klenirken hata oluÅŸtu:', error);
    }
  };
  
  // Toplam aylÄ±k geliri hesapla
  const calculateTotalMonthlyIncome = (): number => {
    return activeClients.reduce((total, client) => {
      return total + (client.monthlyIncome || 0);
    }, 0);
  };
  
  // Gelir deÄŸiÅŸimini hesapla (pozitif veya negatif)
  const calculateIncomeChange = (): number => {
    // Toplam aylÄ±k geliri hesapla
    const totalMonthlyIncome = calculateTotalMonthlyIncome();
    
    // Ã–deme durumlarÄ±na gÃ¶re mÃ¼ÅŸterileri say
    const paidClientsCount = activeClients.filter(c => c.paymentStatus === 'paid').length;
    const pendingClientsCount = activeClients.filter(c => c.paymentStatus === 'pending').length;
    const overdueClientsCount = activeClients.filter(c => c.paymentStatus === 'overdue').length;
    
    // Ã–deme durumlarÄ±na gÃ¶re aÄŸÄ±rlÄ±klÄ± bir deÄŸiÅŸim hesapla
    // Ã–denmiÅŸ mÃ¼ÅŸteriler pozitif etki, gecikmiÅŸ mÃ¼ÅŸteriler negatif etki yapar
    const totalClients = paidClientsCount + pendingClientsCount + overdueClientsCount;
    
    if (totalClients === 0) return 0;
    
    // Ã–deme durumlarÄ±na gÃ¶re aÄŸÄ±rlÄ±klÄ± bir deÄŸiÅŸim hesapla
    const changeRate = ((paidClientsCount * 0.1) - (overdueClientsCount * 0.15)) / totalClients;
    
    return changeRate;
  };
  
  // Gelir deÄŸiÅŸim yÃ¼zdesini hesapla
  const calculateIncomeChangePercentage = (): number => {
    const change = calculateIncomeChange();
    // YÃ¼zdeye Ã§evir ve en yakÄ±n tam sayÄ±ya yuvarla
    return Math.round(change * 100);
  };
  
  // Ã–denen yÃ¼zdeyi hesapla
  const calculatePaidPercentage = (): number => {
    // Sadece aylÄ±k geliri olan aktif mÃ¼ÅŸterileri hesaba kat
    const clientsWithIncome = activeClients.filter(client => client.monthlyIncome && client.monthlyIncome > 0);
    const totalIncome = clientsWithIncome.reduce((sum, client) => sum + (client.monthlyIncome || 0), 0);
    
    if (totalIncome === 0) return 0;
    
    // Ã–denmiÅŸ durumundaki mÃ¼ÅŸterilerin toplam geliri
    const paidIncome = clientsWithIncome
      .filter(client => client.paymentStatus === 'paid')
      .reduce((sum, client) => sum + (client.monthlyIncome || 0), 0);
    
    // Ã–denen gelirin toplam gelire oranÄ±
    return Math.round((paidIncome / totalIncome) * 100);
  };
  
  // Bekleyen Ã¶demelerin yÃ¼zdesini hesapla
  const calculatePendingPercentage = (): number => {
    // Sadece aylÄ±k geliri olan aktif mÃ¼ÅŸterileri hesaba kat
    const clientsWithIncome = activeClients.filter(client => client.monthlyIncome && client.monthlyIncome > 0);
    const totalIncome = clientsWithIncome.reduce((sum, client) => sum + (client.monthlyIncome || 0), 0);
    
    if (totalIncome === 0) return 0;
    
    // Bekleyen durumundaki mÃ¼ÅŸterilerin toplam geliri
    const pendingIncome = clientsWithIncome
      .filter(client => client.paymentStatus === 'pending')
      .reduce((sum, client) => sum + (client.monthlyIncome || 0), 0);
    
    // Geciken durumundaki mÃ¼ÅŸterilerin toplam geliri
    const overdueIncome = clientsWithIncome
      .filter(client => client.paymentStatus === 'overdue')
      .reduce((sum, client) => sum + (client.monthlyIncome || 0), 0);
    
    // Bekleyen ve geciken Ã¶demelerin toplam gelire oranÄ±
    return Math.round(((pendingIncome + overdueIncome) / totalIncome) * 100);
  };
  
  // KullanÄ±cÄ± adÄ±nÄ± ve avatarÄ±nÄ± getir
  const getUserInfo = (userId: number) => {
    const user = activeUsers.find(u => u.id === userId);
    return {
      name: user ? user.name : 'Bilinmeyen KullanÄ±cÄ±',
      avatar: user?.avatarUrl || userAvatars[userId] || `https://randomuser.me/api/portraits/${userId % 2 === 0 ? 'women' : 'men'}/${userId % 10}.jpg`
    };
  };
  
  // GÃ¶rev durumunu metin olarak dÃ¶ndÃ¼r
  const getTaskStatusText = (status: string) => {
    switch (status) {
      case 'Bekliyor': return 'Yeni';
      case 'Devam Ediyor': return 'Devam Ediyor';
      case 'TamamlandÄ±': return 'TamamlandÄ±';
      case 'Ä°ptal Edildi': return 'Ä°ptal';
      default: return status;
    }
  };
  
  // GÃ¶rev durumuna gÃ¶re renk belirle
  const getStatusColor = (status: string): 'primary' | 'warning' | 'success' | 'error' | 'default' => {
    switch (status) {
      case 'Bekliyor': return 'primary';
      case 'Devam Ediyor': return 'warning';
      case 'TamamlandÄ±': return 'success';
      case 'Ä°ptal Edildi': return 'error';
      default: return 'default';
    }
  };
  
  // Son 6 ayÄ±n isimlerini oluÅŸtur
  const getLastSixMonths = () => {
    const months: string[] = [];
    const now = new Date();
    
    for (let i = 5; i >= 0; i--) {
      const month = new Date(now.getFullYear(), now.getMonth() - i, 1);
      // format fonksiyonunu kullanarak ay isimlerini oluÅŸtur
      months.push(format(month, 'MMM', { locale: tr }));
    }
    
    return months;
  };
  
  // Aylara gÃ¶re gÃ¶rev sayÄ±larÄ±nÄ± hesapla
  const getTaskCountsByMonth = () => {
    const months = getLastSixMonths();
    const now = new Date();
    const currentMonth = now.getMonth();
    const currentYear = now.getFullYear();
    
    // Her ay iÃ§in gÃ¶rev durumlarÄ±nÄ± saklamak iÃ§in baÅŸlangÄ±Ã§ verileri
    const completedTasks = Array(6).fill(0);
    const ongoingTasks = Array(6).fill(0);
    const pendingTasks = Array(6).fill(0);
    const cancelledTasks = Array(6).fill(0);
    
    // TÃ¼m gÃ¶revleri dÃ¶ngÃ¼ye al ve aylara gÃ¶re daÄŸÄ±t
    tasks.forEach(task => {
      // BitiÅŸ tarihini kullan (daha anlamlÄ± bir gÃ¶sterge)
      // EÄŸer bitiÅŸ tarihi yoksa, oluÅŸturulma tarihini kullan
      const taskDate = new Date(task.due_date || task.created_at);
      const taskMonth = taskDate.getMonth();
      const taskYear = taskDate.getFullYear();
      
      // Son 6 ay iÃ§indeki gÃ¶revleri bul
      for (let i = 0; i < 6; i++) {
        const targetMonth = (currentMonth - i + 12) % 12; // Negatif ay indekslerini dÃ¼zelt
        const targetYear = currentYear - (currentMonth < i ? 1 : 0); // YÄ±l geÃ§iÅŸlerini dÃ¼zelt
        
        if (taskMonth === targetMonth && taskYear === targetYear) {
          // GÃ¶rev durumuna gÃ¶re ilgili aya ekle
          switch (task.status) {
            case 'TamamlandÄ±':
              completedTasks[5 - i]++;
              break;
            case 'Devam Ediyor':
              ongoingTasks[5 - i]++;
              break;
            case 'Bekliyor':
              pendingTasks[5 - i]++;
              break;
            case 'Ä°ptal Edildi':
              cancelledTasks[5 - i]++;
              break;
          }
          break;
        }
      }
    });
    
    // Mevcut ay iÃ§in gÃ¶rev sayÄ±larÄ±nÄ± doÄŸru ÅŸekilde gÃ¶stermek iÃ§in ek kontrol
    // EÄŸer mevcut ay iÃ§in hiÃ§ gÃ¶rev yoksa ve diÄŸer aylarda gÃ¶rev varsa
    // Muhtemelen gÃ¶revler geÃ§miÅŸ aylara ait, ancak hala aktif
    if (completedTasks[5] === 0 && ongoingTasks[5] === 0 && pendingTasks[5] === 0) {
      // Devam eden ve bekleyen gÃ¶revleri say
      const activeTaskCount = tasks.filter(t => 
        t.status === 'Devam Ediyor' || t.status === 'Bekliyor'
      ).length;
      
      // Aktif gÃ¶revleri mevcut aya ekle
      if (activeTaskCount > 0) {
        // Devam eden ve bekleyen gÃ¶revleri yaklaÅŸÄ±k olarak bÃ¶l
        ongoingTasks[5] = Math.ceil(activeTaskCount * 0.6); // %60'Ä± devam ediyor
        pendingTasks[5] = activeTaskCount - ongoingTasks[5]; // KalanÄ± bekliyor
      }
    }
    
    return {
      months,
      completedTasks,
      ongoingTasks,
      pendingTasks,
      cancelledTasks
    };
  };
  
  // MÃ¼ÅŸterilerin sektÃ¶rlere gÃ¶re daÄŸÄ±lÄ±mÄ±nÄ± hesapla
  const calculateClientSectorDistribution = () => {
    const sectorCounts: Record<string, number> = {};
    
    // Sadece aktif mÃ¼ÅŸterileri hesaba kat
    const clients = activeClients.filter(client => client.isActive);
    
    // MÃ¼ÅŸterileri sektÃ¶rlere gÃ¶re say
    clients.forEach(client => {
      if (client.sector) {
        // EÄŸer sektÃ¶r zaten kayÄ±tlÄ±ysa, sayÄ±sÄ±nÄ± artÄ±r
        if (sectorCounts[client.sector]) {
          sectorCounts[client.sector]++;
        } else {
          // Yeni sektÃ¶r ekliyoruz
          sectorCounts[client.sector] = 1;
        }
      } else {
        // SektÃ¶rÃ¼ olmayan mÃ¼ÅŸteriler iÃ§in 'DiÄŸer' kategorisini kullan
        if (sectorCounts['DiÄŸer']) {
          sectorCounts['DiÄŸer']++;
        } else {
          sectorCounts['DiÄŸer'] = 1;
        }
      }
    });
    
    // SektÃ¶rleri mÃ¼ÅŸteri sayÄ±sÄ±na gÃ¶re sÄ±rala (en yÃ¼ksekten en dÃ¼ÅŸÃ¼ÄŸe)
    const sortedSectors = Object.keys(sectorCounts).sort((a, b) => sectorCounts[b] - sectorCounts[a]);
    const sortedCounts = sortedSectors.map(sector => sectorCounts[sector]);
    
    return {
      sectors: sortedSectors,
      counts: sortedCounts
    };
  };
  
  // Gelir verilerini hesapla - mÃ¼ÅŸteri Ã¶demelerine gÃ¶re
  const calculateRevenueData = () => {
    const months = getLastSixMonths();
    const now = new Date();
    const currentMonth = now.getMonth();
    const currentYear = now.getFullYear();
    
    // Her ay iÃ§in gelir verilerini saklamak iÃ§in baÅŸlangÄ±Ã§ dizileri
    const paidRevenue = Array(6).fill(0);
    const pendingRevenue = Array(6).fill(0);
    const overdueRevenue = Array(6).fill(0);
    
    // TÃ¼m aktif mÃ¼ÅŸterileri dÃ¶ngÃ¼ye al
    activeClients.forEach(client => {
      // MÃ¼ÅŸterinin aylÄ±k geliri yoksa hesaplama yapma
      if (!client.monthlyIncome) return;
      
      // Mevcut ay iÃ§in Ã¶deme durumuna gÃ¶re geliri ekle
      if (client.paymentStatus === 'paid') {
        paidRevenue[5] += client.monthlyIncome;
      } else if (client.paymentStatus === 'pending') {
        pendingRevenue[5] += client.monthlyIncome;
      } else if (client.paymentStatus === 'overdue') {
        overdueRevenue[5] += client.monthlyIncome;
      }
      
      // Son Ã¶deme tarihini kontrol et
      if (client.lastPaymentDate) {
        const lastPaymentDate = new Date(client.lastPaymentDate);
        const paymentMonth = lastPaymentDate.getMonth();
        const paymentYear = lastPaymentDate.getFullYear();
        
        // Son 6 ay iÃ§indeki Ã¶demeleri bul
        for (let i = 1; i < 6; i++) { // i=1'den baÅŸla Ã§Ã¼nkÃ¼ mevcut ay iÃ§in zaten yukarÄ±da ekledik
          const targetMonth = (currentMonth - i + 12) % 12; // Negatif ay indekslerini dÃ¼zelt
          const targetYear = currentYear - (currentMonth < i ? 1 : 0); // YÄ±l geÃ§iÅŸlerini dÃ¼zelt
          
          // Ã–deme bu ay iÃ§inde mi kontrol et
          const isPaymentInThisMonth = (paymentMonth === targetMonth && paymentYear === targetYear);
          
          if (isPaymentInThisMonth) {
            // Bu ayda Ã¶deme yapÄ±lmÄ±ÅŸsa, Ã¶dendi olarak iÅŸaretle
            paidRevenue[5 - i] += client.monthlyIncome;
          } else {
            // Ã–nceki aylarda Ã¶deme durumunu mÃ¼ÅŸterinin mevcut durumuna gÃ¶re belirle
            // Bu daha gerÃ§ekÃ§i bir yaklaÅŸÄ±m olacaktÄ±r
            if (client.paymentStatus === 'paid' || client.paymentStatus === 'pending') {
              // DÃ¼zenli Ã¶deme yapan mÃ¼ÅŸteriler iÃ§in geÃ§miÅŸ aylarÄ± da Ã¶denmiÅŸ varsay
              paidRevenue[5 - i] += client.monthlyIncome;
            } else if (client.paymentStatus === 'overdue') {
              // Ã–demesi geciken mÃ¼ÅŸteriler iÃ§in geÃ§miÅŸ aylarÄ± da gecikmiÅŸ varsay
              // Ancak son Ã¶deme tarihinden Ã¶nceki aylar iÃ§in Ã¶dendi varsay
              const monthsSinceLastPayment = (currentMonth - paymentMonth + 12) % 12;
              if (i > monthsSinceLastPayment) {
                paidRevenue[5 - i] += client.monthlyIncome;
              } else {
                overdueRevenue[5 - i] += client.monthlyIncome;
              }
            }
          }
        }
      } else {
        // Son Ã¶deme tarihi yoksa, mÃ¼ÅŸterinin mevcut durumuna gÃ¶re geÃ§miÅŸ aylarÄ± tahmin et
        for (let i = 1; i < 6; i++) {
          if (client.paymentStatus === 'paid') {
            // DÃ¼zenli Ã¶deme yapan mÃ¼ÅŸteriler iÃ§in geÃ§miÅŸ aylarÄ± da Ã¶denmiÅŸ varsay
            paidRevenue[5 - i] += client.monthlyIncome;
          } else if (client.paymentStatus === 'pending') {
            // Bekleyen Ã¶demesi olan mÃ¼ÅŸteriler iÃ§in son 2 ayÄ± beklemede, Ã¶ncesini Ã¶denmiÅŸ varsay
            if (i <= 2) {
              pendingRevenue[5 - i] += client.monthlyIncome;
            } else {
              paidRevenue[5 - i] += client.monthlyIncome;
            }
          } else if (client.paymentStatus === 'overdue') {
            // GecikmiÅŸ Ã¶demesi olan mÃ¼ÅŸteriler iÃ§in son 3 ayÄ± gecikmiÅŸ, Ã¶ncesini Ã¶denmiÅŸ varsay
            if (i <= 3) {
              overdueRevenue[5 - i] += client.monthlyIncome;
            } else {
              paidRevenue[5 - i] += client.monthlyIncome;
            }
          }
        }
      }
    });
    
    return {
      months,
      paidRevenue,
      pendingRevenue,
      overdueRevenue
    };
  };
  
  // GÃ¶rev tamamlama verileri
  const taskData = getTaskCountsByMonth();
  const taskCompletionData = {
    labels: taskData.months,
    datasets: [
      {
        label: 'Tamamlanan',
        data: taskData.completedTasks,
        backgroundColor: theme.palette.success.main,
      },
      {
        label: 'Devam Eden',
        data: taskData.ongoingTasks,
        backgroundColor: theme.palette.warning.main,
      },
      {
        label: 'Bekleyen',
        data: taskData.pendingTasks,
        backgroundColor: theme.palette.primary.main,
      },
    ],
  };
  
  // MÃ¼ÅŸteri daÄŸÄ±lÄ±m verileri
  const clientDistribution = calculateClientSectorDistribution();
  const clientDistributionData = {
    labels: clientDistribution.sectors,
    datasets: [
      {
        data: clientDistribution.counts,
        backgroundColor: [
          '#1877f2', // Mavi
          '#e1306c', // Pembe
          '#ff9800', // Turuncu
          '#4caf50', // YeÅŸil
          '#9c27b0', // Mor
          '#f44336', // KÄ±rmÄ±zÄ±
          '#2196f3', // AÃ§Ä±k Mavi
          '#607d8b', // Gri Mavi
          '#795548', // Kahverengi
          '#00bcd4', // Turkuaz
        ],
        borderWidth: 0,
      },
    ],
  };
  
  // Gelir analiz verileri
  const revenueDataCalc = calculateRevenueData();
  const revenueData = {
    labels: revenueDataCalc.months,
    datasets: [
      {
        label: 'Tahsil Edilen',
        data: revenueDataCalc.paidRevenue,
        borderColor: theme.palette.success.main,
        backgroundColor: 'rgba(76, 175, 80, 0.1)',
        fill: true,
        tension: 0.4,
      },
      {
        label: 'Bekleyen',
        data: revenueDataCalc.pendingRevenue,
        borderColor: theme.palette.warning.main,
        backgroundColor: 'rgba(255, 152, 0, 0.1)',
        fill: true,
        tension: 0.4,
      },
      {
        label: 'GecikmiÅŸ',
        data: revenueDataCalc.overdueRevenue,
        borderColor: theme.palette.error.main,
        backgroundColor: 'rgba(244, 67, 54, 0.1)',
        fill: true,
        tension: 0.4,
      },
    ],
  };
  
  // SektÃ¶r daÄŸÄ±lÄ±mÄ± verilerini hesapla
  const sectorDistribution = calculateClientSectorDistribution();
  
  // SektÃ¶r daÄŸÄ±lÄ±mÄ± grafik verileri
  const sectorData = {
    labels: sectorDistribution.sectors,
    datasets: [
      {
        data: sectorDistribution.counts,
        backgroundColor: sectorDistribution.sectors.map((_, index) => 
          avatarColors[index % avatarColors.length]
        ),
        borderWidth: 0,
      },
    ],
  };
  
  return (
    <Box sx={{ p: 3 }}>
      <Grid container spacing={3}>
        {/* Ãœst SÄ±ra Widget'larÄ± */}
        <Grid item xs={12} md={6} lg={3}>
          <Card sx={{
            boxShadow: theme.palette.mode === 'dark' 
              ? '0 8px 16px 0 rgba(0,0,0,0.2)' 
              : '0 8px 16px 0 rgba(0,0,0,0.1)',
            height: '100%'
          }}>
            <CardContent sx={{ p: 3 }}>
              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h6" fontWeight="bold">
                  AylÄ±k Gelir
                </Typography>
                <Avatar sx={{ bgcolor: theme.palette.primary.main }}>
                  <TrendingUpIcon />
                </Avatar>
              </Box>
              <Typography variant="h4" fontWeight="bold" sx={{ mb: 1 }}>
                â‚º{calculateTotalMonthlyIncome().toLocaleString()}
              </Typography>
              <Box sx={{ display: 'flex', alignItems: 'center' }}>
                {calculateIncomeChangePercentage() >= 0 ? (
                  <Chip 
                    icon={<TrendingUpIcon fontSize="small" />} 
                    label={`+${calculateIncomeChangePercentage()}%`} 
                    size="small" 
                    color="success" 
                    sx={{ height: 24, fontSize: '0.7rem' }}
                  />
                ) : (
                  <Chip 
                    icon={<TrendingDownIcon fontSize="small" />} 
                    label={`${calculateIncomeChangePercentage()}%`} 
                    size="small" 
                    color="error" 
                    sx={{ height: 24, fontSize: '0.7rem' }}
                  />
                )}
                <Typography variant="body2" color="text.secondary" sx={{ ml: 1 }}>
                  geÃ§en aya gÃ¶re
                </Typography>
              </Box>
              <Box sx={{ mt: 2 }}>
                <LinearProgress 
                  variant="determinate" 
                  value={calculatePaidPercentage()} 
                  color="success"
                  sx={{ height: 8, borderRadius: 4, mb: 1 }}
                />
                <Typography variant="caption" color="text.secondary">
                  Ã–denen: %{calculatePaidPercentage()} | Bekleyen: %{calculatePendingPercentage()}
                </Typography>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        
        <Grid item xs={12} md={6} lg={3}>
          <Card sx={{
            boxShadow: theme.palette.mode === 'dark' 
              ? '0 8px 16px 0 rgba(0,0,0,0.2)' 
              : '0 8px 16px 0 rgba(0,0,0,0.1)',
            height: '100%'
          }}>
            <CardContent sx={{ p: 3 }}>
              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h6" fontWeight="bold">
                  Aktif MÃ¼ÅŸteriler
                </Typography>
                <Avatar sx={{ bgcolor: theme.palette.success.main }}>
                  <BusinessIcon />
                </Avatar>
              </Box>
              <Typography variant="h4" fontWeight="bold" sx={{ mb: 1 }}>
                {activeClients.length}
              </Typography>
              <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
                <Chip 
                  label="TÃ¼m MÃ¼ÅŸteriler" 
                  size="small" 
                  color="primary" 
                  sx={{ height: 24, fontSize: '0.7rem' }}
                />
              </Box>
              <Box sx={{ mt: 2 }}>
                <List sx={{ p: 0 }}>
                  {activeClients.slice(0, 3).map((client, index) => (
                    <ListItem key={client.id} sx={{ px: 0, py: 0.5 }}>
                      <ListItemAvatar sx={{ minWidth: 40 }}>
                        <Avatar 
                          sx={{ 
                            width: 32, 
                            height: 32, 
                            bgcolor: avatarColors[index % avatarColors.length],
                            fontSize: '0.9rem'
                          }}
                        >
                          {client.name.charAt(0)}
                        </Avatar>
                      </ListItemAvatar>
                      <ListItemText 
                        primary={client.name} 
                        secondary={client.sector || 'Genel'}
                        primaryTypographyProps={{ variant: 'body2', fontWeight: 'medium' }}
                        secondaryTypographyProps={{ variant: 'caption' }}
                      />
                    </ListItem>
                  ))}
                </List>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        
        <Grid item xs={12} md={6} lg={3}>
          <Card sx={{
            boxShadow: theme.palette.mode === 'dark' 
              ? '0 8px 16px 0 rgba(0,0,0,0.2)' 
              : '0 8px 16px 0 rgba(0,0,0,0.1)',
            height: '100%'
          }}>
            <CardContent sx={{ p: 3 }}>
              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h6" fontWeight="bold">
                  Aktif Projeler
                </Typography>
                <Avatar sx={{ bgcolor: theme.palette.warning.main }}>
                  <FlagIcon />
                </Avatar>
              </Box>
              <Typography variant="h4" fontWeight="bold" sx={{ mb: 1 }}>
                {activeProjectCount}
              </Typography>
              <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
                <Chip 
                  label="Devam Eden" 
                  size="small" 
                  color="warning" 
                  sx={{ height: 24, fontSize: '0.7rem', mr: 1 }}
                />
                <Chip 
                  label="Tamamlanan" 
                  size="small" 
                  color="success" 
                  sx={{ height: 24, fontSize: '0.7rem' }}
                />
              </Box>
              <Box sx={{ mt: 2 }}>
                <List sx={{ p: 0 }}>
                  {projects.slice(0, 3).map((project, index) => (
                    <ListItem key={index} sx={{ px: 0, py: 0.5 }}>
                      <ListItemText 
                        primary={project.name} 
                        secondary={`${project.completedTasks}/${project.totalTasks} gÃ¶rev`}
                        primaryTypographyProps={{ variant: 'body2', fontWeight: 'medium' }}
                        secondaryTypographyProps={{ variant: 'caption' }}
                      />
                      <LinearProgress 
                        variant="determinate" 
                        value={project.progress} 
                        color={project.progress === 100 ? 'success' : 'primary'}
                        sx={{ width: 60, height: 6, borderRadius: 3 }}
                      />
                    </ListItem>
                  ))}
                </List>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        
        <Grid item xs={12} md={6} lg={3}>
          <Card sx={{
            boxShadow: theme.palette.mode === 'dark' 
              ? '0 8px 16px 0 rgba(0,0,0,0.2)' 
              : '0 8px 16px 0 rgba(0,0,0,0.1)',
            height: '100%'
          }}>
            <CardContent sx={{ p: 3 }}>
              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h6" fontWeight="bold">
                  Tamamlanan GÃ¶revler
                </Typography>
                <Avatar sx={{ bgcolor: theme.palette.success.main }}>
                  <CheckCircleIcon />
                </Avatar>
              </Box>
              <Typography variant="h4" fontWeight="bold" sx={{ mb: 1 }}>
                {completedTaskCount}
              </Typography>
              <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
                {completedTasksChange > 0 ? (
                  <>
                    <TrendingUpIcon sx={{ color: 'success.main', mr: 1, fontSize: 20 }} />
                    <Typography variant="body2" color="success.main" fontWeight="medium">
                      %{Math.abs(completedTasksChange)} artÄ±ÅŸ
                    </Typography>
                  </>
                ) : completedTasksChange < 0 ? (
                  <>
                    <TrendingDownIcon sx={{ color: 'error.main', mr: 1, fontSize: 20 }} />
                    <Typography variant="body2" color="error.main" fontWeight="medium">
                      %{Math.abs(completedTasksChange)} azalÄ±ÅŸ
                    </Typography>
                  </>
                ) : (
                  <Typography variant="body2" color="text.secondary" fontWeight="medium">
                    DeÄŸiÅŸim yok
                  </Typography>
                )}
                <Chip 
                  label="Son 30 gÃ¼n" 
                  size="small" 
                  color="success" 
                  sx={{ height: 24, fontSize: '0.7rem', ml: 1 }}
                />
              </Box>
              <Box sx={{ mt: 2 }}>
                <List sx={{ p: 0 }}>
                  {completedTasks.map((task, index) => {
                    const userInfo = getUserInfo(task.assigned_to);
                    return (
                      <ListItem key={task.id} sx={{ px: 0, py: 0.5 }}>
                        <ListItemAvatar sx={{ minWidth: 40 }}>
                          <Avatar 
                            src={userInfo.avatar}
                            sx={{ width: 32, height: 32 }}
                          />
                        </ListItemAvatar>
                        <ListItemText 
                          primary={task.title} 
                          secondary={format(new Date(task.due_date), 'dd MMM yyyy', { locale: tr })}
                          primaryTypographyProps={{ variant: 'body2', fontWeight: 'medium' }}
                          secondaryTypographyProps={{ variant: 'caption' }}
                        />
                        <Chip 
                          label={getTaskStatusText(task.status)} 
                          size="small" 
                          color={getStatusColor(task.status) as any}
                          sx={{ height: 24, fontSize: '0.7rem' }}
                        />
                      </ListItem>
                    );
                  })}
                </List>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        
        <Grid item xs={12} md={6} lg={3}>
          <Card sx={{
            boxShadow: theme.palette.mode === 'dark' 
              ? '0 8px 16px 0 rgba(0,0,0,0.2)' 
              : '0 8px 16px 0 rgba(0,0,0,0.1)',
            height: '100%'
          }}>
            <CardContent sx={{ p: 3 }}>
              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h6" fontWeight="bold">
                  Devam Eden GÃ¶revler
                </Typography>
                <Avatar sx={{ bgcolor: theme.palette.info.main }}>
                  <ScheduleIcon />
                </Avatar>
              </Box>
              <Typography variant="h4" fontWeight="bold" sx={{ mb: 1 }}>
                {ongoingTasks.length}
              </Typography>
              <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
                <Chip 
                  label="YakÄ±n Tarihli" 
                  size="small" 
                  color="info" 
                  sx={{ height: 24, fontSize: '0.7rem' }}
                />
              </Box>
              <Box sx={{ mt: 2 }}>
                <List sx={{ p: 0 }}>
                  {ongoingTasks.map((task, index) => {
                    const userInfo = getUserInfo(task.assigned_to);
                    return (
                      <ListItem key={task.id} sx={{ px: 0, py: 0.5 }}>
                        <ListItemAvatar sx={{ minWidth: 40 }}>
                          <Avatar 
                            src={userInfo.avatar}
                            sx={{ width: 32, height: 32 }}
                          />
                        </ListItemAvatar>
                        <ListItemText 
                          primary={task.title} 
                          secondary={format(new Date(task.due_date), 'dd MMM yyyy', { locale: tr })}
                          primaryTypographyProps={{ variant: 'body2', fontWeight: 'medium' }}
                          secondaryTypographyProps={{ variant: 'caption' }}
                        />
                        <Chip 
                          label={getTaskStatusText(task.status)} 
                          size="small" 
                          color={getStatusColor(task.status) as any}
                          sx={{ height: 24, fontSize: '0.7rem' }}
                        />
                      </ListItem>
                    );
                  })}
                </List>
              </Box>
            </CardContent>
          </Card>
        </Grid>
        
        {/* Grafik SatÄ±rÄ± */}
        <Grid item xs={12} md={8}>
          <Card sx={{
            boxShadow: theme.palette.mode === 'dark' 
              ? '0 8px 16px 0 rgba(0,0,0,0.2)' 
              : '0 8px 16px 0 rgba(0,0,0,0.1)',
            height: '100%'
          }}>
            <CardContent sx={{ p: 3 }}>
              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h6" sx={{ mb: 2 }}>
                  GÃ¶rev Tamamlama Analizi
                </Typography>
                <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
                  Son 6 ay iÃ§indeki gÃ¶rev durumlarÄ±nÄ±n analizi
                </Typography>
                <IconButton size="small">
                  <MoreVertIcon />
                </IconButton>
              </Box>
              <Box sx={{ height: 300 }}>
                <Bar 
                  data={taskCompletionData} 
                  options={{
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                      legend: {
                        position: 'top',
                        align: 'end',
                      },
                    },
                    scales: {
                      x: {
                        grid: {
                          display: false,
                        },
                      },
                      y: {
                        beginAtZero: true,
                      }
                    }
                  }}
                />
              </Box>
            </CardContent>
          </Card>
        </Grid>
        
        <Grid item xs={12} md={4}>
          <Card sx={{
            boxShadow: theme.palette.mode === 'dark' 
              ? '0 8px 16px 0 rgba(0,0,0,0.2)' 
              : '0 8px 16px 0 rgba(0,0,0,0.1)',
            height: '100%'
          }}>
            <CardContent sx={{ p: 3 }}>
              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h6" sx={{ mb: 2 }}>
                  MÃ¼ÅŸteri SektÃ¶r DaÄŸÄ±lÄ±mÄ±
                </Typography>
                <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
                  Aktif mÃ¼ÅŸterilerin sektÃ¶rlere gÃ¶re daÄŸÄ±lÄ±mÄ±
                </Typography>
                <IconButton size="small">
                  <MoreVertIcon />
                </IconButton>
              </Box>
              <Box sx={{ height: 300, display: 'flex', justifyContent: 'center', alignItems: 'center' }}>
                <Doughnut 
                  data={clientDistributionData} 
                  options={{
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                      legend: {
                        position: 'bottom',
                      },
                    },
                  }}
                />
              </Box>
            </CardContent>
          </Card>
        </Grid>
        
        {/* Alt SatÄ±r */}
        <Grid item xs={12} md={8}>
          <Card sx={{
            boxShadow: theme.palette.mode === 'dark' 
              ? '0 8px 16px 0 rgba(0,0,0,0.2)' 
              : '0 8px 16px 0 rgba(0,0,0,0.1)',
            height: '100%'
          }}>
            <CardContent sx={{ p: 3 }}>
              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h6" sx={{ mb: 2 }}>
                  Gelir Analizi
                </Typography>
                <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
                  Son 6 ay iÃ§indeki Ã¶deme durumlarÄ±na gÃ¶re gelir analizi
                </Typography>
                <IconButton size="small">
                  <MoreVertIcon />
                </IconButton>
              </Box>
              <Box sx={{ height: 300 }}>
                <Line 
                  data={revenueData} 
                  options={{
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                      legend: {
                        position: 'top',
                        align: 'end',
                      },
                    },
                    scales: {
                      x: {
                        grid: {
                          display: false,
                        },
                      },
                      y: {
                        beginAtZero: true,
                      }
                    }
                  }}
                />
              </Box>
            </CardContent>
          </Card>
        </Grid>
        
        <Grid item xs={12} md={4}>
          <Card sx={{
            boxShadow: theme.palette.mode === 'dark' 
              ? '0 8px 16px 0 rgba(0,0,0,0.2)' 
              : '0 8px 16px 0 rgba(0,0,0,0.1)',
            height: '100%'
          }}>
            <CardContent sx={{ p: 3 }}>
              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
                <Typography variant="h6" fontWeight="bold">
                  Sosyal Medya
                </Typography>
                <IconButton size="small">
                  <MoreVertIcon />
                </IconButton>
              </Box>
              <Grid container spacing={3}>
                <Grid item xs={12} sm={6}>
                  <Doughnut 
                    data={sectorData} 
                    options={{
                      responsive: true,
                      maintainAspectRatio: false,
                      plugins: {
                        legend: {
                          display: false,
                        },
                      },
                      scales: {
                        x: {
                          beginAtZero: true,
                        }
                      }
                    }}
                    height={150}
                  />
                </Grid>
                <Grid item xs={12} sm={6}>
                  <List sx={{ p: 0 }}>
                    {/* MÃ¼ÅŸteri sektÃ¶r daÄŸÄ±lÄ±mÄ±nÄ± gÃ¶ster */}
                    {sectorDistribution.sectors.slice(0, 4).map((sector, index) => {
                      const count = sectorDistribution.counts[index];
                      const color = avatarColors[index % avatarColors.length];
                      
                      // SektÃ¶rÃ¼n toplam mÃ¼ÅŸteri sayÄ±sÄ±na oranÄ±
                      const totalClients = sectorDistribution.counts.reduce((sum, c) => sum + c, 0);
                      const percentage = totalClients > 0 ? Math.round((count / totalClients) * 100) : 0;
                      
                      return (
                        <ListItem key={sector} sx={{ px: 0 }}>
                          <ListItemAvatar>
                            <Avatar sx={{ bgcolor: color }}>
                              {sector.charAt(0)}
                            </Avatar>
                          </ListItemAvatar>
                          <ListItemText 
                            primary={sector} 
                            secondary={`${count} mÃ¼ÅŸteri`} 
                            primaryTypographyProps={{ variant: 'subtitle2' }}
                            secondaryTypographyProps={{ variant: 'caption' }}
                          />
                          <Chip 
                            label={`${percentage}%`} 
                            size="small" 
                            color={percentage > 20 ? "success" : "primary"} 
                            sx={{ height: 24, fontSize: '0.7rem' }}
                          />
                        </ListItem>
                      );
                    })}
                    
                    {/* EÄŸer 4'ten az sektÃ¶r varsa boÅŸ listeler ekle */}
                    {Array.from({ length: Math.max(0, 4 - sectorDistribution.sectors.length) }).map((_, i) => (
                      <ListItem key={`empty-${i}`} sx={{ px: 0, opacity: 0.5 }}>
                        <ListItemAvatar>
                          <Avatar sx={{ bgcolor: 'grey.300' }}>
                            <BusinessIcon />
                          </Avatar>
                        </ListItemAvatar>
                        <ListItemText 
                          primary="Veri yok" 
                          secondary="0 mÃ¼ÅŸteri" 
                          primaryTypographyProps={{ variant: 'subtitle2' }}
                          secondaryTypographyProps={{ variant: 'caption' }}
                        />
                        <Chip 
                          label="0%" 
                          size="small" 
                          color="default" 
                          sx={{ height: 24, fontSize: '0.7rem' }}
                        />
                      </ListItem>
                    ))}
                  </List>
                </Grid>
              </Grid>
            </CardContent>
          </Card>
        </Grid>
      </Grid>
    </Box>
  );
}
